<!-- Modal de connexion -->
<div *ngIf="showLoginModal" class="login-modal-overlay">
  <div class="login-modal">
    <h2>ğŸ¯ Connexion Motus</h2>
    
    <form (ngSubmit)="onLogin()" #loginForm="ngForm">
      <div class="form-group">
        <label>Alias de jeu :</label>
        <input 
          type="text" 
          [(ngModel)]="loginAlias" 
          name="alias"
          required
          maxlength="20"
          placeholder="Votre pseudo de jeu"
        >
      </div>

      <div class="form-group">
        <label>Email :</label>
        <input 
          type="email" 
          [(ngModel)]="loginEmail" 
          name="email"
          required
          placeholder="votre@email.com"
        >
      </div>

      <div class="form-group">
        <label>Mot de passe :</label>
        <input 
          type="password" 
          [(ngModel)]="loginPassword" 
          name="password"
          required
          placeholder="Votre mot de passe"
        >
      </div>

      <div *ngIf="loginError" class="error-message">
        {{ loginError }}
      </div>

      <button 
        type="submit" 
        [disabled]="loginForm.invalid || loginLoading"
        class="login-btn"
      >
        <span *ngIf="loginLoading">â³ Connexion...</span>
        <span *ngIf="!loginLoading">ğŸš€ Se connecter</span>
      </button>

      <!-- Bouton de test -->
      <button 
        type="button" 
        (click)="useTestAccount()" 
        class="test-btn"
      >
        ğŸ§ª Utiliser compte de test
      </button>
    </form>
  </div>
</div>

<!-- âœ… Informations du joueur -->
<div class="player-info" *ngIf="isAuthenticated && !showLoginModal">
  <div class="player-card">
    <span class="player-icon">ğŸ‘¤</span>
    <span class="player-name">{{ getCurrentPlayerAlias() }}</span>
    <button class="change-alias-btn-mini" (click)="changeAlias()" title="Changer de pseudo">âœï¸</button>
  </div>
</div>

<!-- âœ… Interface de jeu avec stats et contrÃ´les -->
<div class="game-interface" *ngIf="isAuthenticated && !showLoginModal">
  
  <!-- Stats de session en temps rÃ©el -->
  <div class="session-stats">
    <div class="stat-card">
      <span class="stat-value">{{ sessionStats.totalScore }}</span>
      <span class="stat-label">Score Total</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">{{ sessionStats.wordsFound }}</span>
      <span class="stat-label">Mots TrouvÃ©s</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">{{ sessionStats.averageScore }}</span>
      <span class="stat-label">Moyenne</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">{{ sessionStats.currentStreak }}</span>
      <span class="stat-label">SÃ©rie Actuelle</span>
    </div>
    <div class="stat-card">
      <span class="stat-value">{{ sessionStats.perfectWords }}</span>
      <span class="stat-label">Mots Parfaits</span>
    </div>
  </div>

  <!-- Boutons de contrÃ´le -->
  <div class="game-controls">
    <button class="change-alias-btn" (click)="changeAlias()">
      âœï¸ Changer pseudo
    </button>
    <button 
      class="end-game-btn" 
      (click)="endGameSession()" 
      *ngIf="sessionStats.wordsFound > 0"
    >
      ğŸ Terminer la session
    </button>
    <button class="logout-btn" (click)="logout()">
      ğŸšª DÃ©connexion
    </button>
  </div>

  <!-- âœ… APERÃ‡U TOP 3 - CORRIGÃ‰ -->
  <div class="top-players-preview" *ngIf="!gameOver && isAuthenticated">
    <div class="preview-header">
      <h3>ğŸ† Hall of Fame</h3>
      <p class="preview-subtitle">Top 3 des meilleurs scores</p>
    </div>
    
    <!-- Podium compact -->
    <div class="podium-mini" *ngIf="topScores.length > 0; else noScoresPreview">
      <!-- ğŸ¥‡ Premier -->
      <div class="podium-item gold" *ngIf="topScores[0]">
        <span class="medal">ğŸ¥‡</span>
        <div class="player-info">
          <span class="player-name">{{ topScores[0].playerAlias }}</span>
          <span class="player-score">{{ topScores[0].totalScore }} pts</span>
          <span class="player-words">{{ topScores[0].wordsFound }} mots</span>
        </div>
      </div>
      
      <!-- ğŸ¥ˆ DeuxiÃ¨me -->
      <div class="podium-item silver" *ngIf="topScores[1]">
        <span class="medal">ğŸ¥ˆ</span>
        <div class="player-info">
          <span class="player-name">{{ topScores[1].playerAlias }}</span>
          <span class="player-score">{{ topScores[1].totalScore }} pts</span>
          <span class="player-words">{{ topScores[1].wordsFound }} mots</span>
        </div>
      </div>
      
      <!-- ğŸ¥‰ TroisiÃ¨me -->
      <div class="podium-item bronze" *ngIf="topScores[2]">
        <span class="medal">ğŸ¥‰</span>
        <div class="player-info">
          <span class="player-name">{{ topScores[2].playerAlias }}</span>
          <span class="player-score">{{ topScores[2].totalScore }} pts</span>
          <span class="player-words">{{ topScores[2].wordsFound }} mots</span>
        </div>
      </div>
    </div>
    
    <!-- Message si pas de scores -->
    <ng-template #noScoresPreview>
      <div class="no-scores-preview">
        <p>ğŸ¯ Aucun champion pour le moment</p>
        <p>Soyez le premier Ã  marquer l'histoire !</p>
      </div>
    </ng-template>
    
    <!-- Actions -->
    <div class="preview-actions">
      <button (click)="openLeaderboardModal()" class="see-full-leaderboard">
        ğŸ“Š Voir le classement complet
      </button>
      <button (click)="loadTopScores()" class="refresh-scores">
        ğŸ”„ Actualiser
      </button>
    </div>
  </div>
</div>

<!-- Page d'accueil pour utilisateurs non connectÃ©s -->
<div *ngIf="!isAuthenticated && !showLoginModal" class="welcome-screen">
  <div class="welcome-content">
    <h1>ğŸ¯ MOTUS</h1>
    <p>Trouvez le mot mystÃ¨re en 6 essais maximum !</p>
    <div class="welcome-features">
      <div class="feature">â­ SystÃ¨me de score progressif</div>
      <div class="feature">ğŸ† Hall of Fame personnalisÃ©</div>
      <div class="feature">ğŸ”¥ Bonus de rapiditÃ© et combo</div>
      <div class="feature">ğŸ“Š Statistiques dÃ©taillÃ©es</div>
    </div>
    <button class="login-btn" (click)="showLogin()">
      ğŸ” Se connecter pour jouer
    </button>
  </div>
</div>

<!-- Grille de jeu (affichÃ©e seulement si authentifiÃ©) -->
<div *ngIf="isAuthenticated && !showLoginModal" class="game-container">
  <!-- En-tÃªte du jeu -->
  <div class="game-header">
    <h1>Motus</h1>
    <div class="game-info">
      <p>Trouvez le mot de {{ wordLength }} lettres</p>
      <div *ngIf="sessionStats.currentStreak > 0" class="streak-indicator">
        ğŸ”¥ SÃ©rie de {{ sessionStats.currentStreak }} mot{{ sessionStats.currentStreak > 1 ? 's' : '' }}
      </div>
    </div>
  </div>

  <!-- Ã‰tats du jeu -->
  <div class="game-status">
    <div *ngIf="hint" class="hint-container">
      <div class="hint-label">ğŸ’¡ Indice :</div>
      <div class="hint-text">Le mot commence par la lettre <strong>{{ hint }}</strong></div>
      <div class="hint-subtext">Cette lettre est dÃ©jÃ  placÃ©e dans la premiÃ¨re case</div>
    </div>
    <div class="attempts">Tentatives restantes : {{ remainingAttempts }}</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
  </div>

  <!-- âœ… Section de difficultÃ© repositionnÃ©e avant la grille -->
  <div class="difficulty-section">
    <h3>ğŸ¯ Niveau de difficultÃ©</h3>
    
    <div class="difficulty-current">
      <span>Actuel: {{ getDifficultyLabel() }}</span>
      <button class="btn btn-outline" (click)="showDifficultySelector = !showDifficultySelector">
        {{ showDifficultySelector ? 'Fermer' : 'Changer' }}
      </button>
    </div>
    
    <!-- âœ… Modal de sÃ©lection de difficultÃ© avec Cauchemar -->
    <div *ngIf="showDifficultySelector" class="difficulty-selector">
      <div class="difficulty-options">
        <button 
          class="difficulty-btn facile"
          [class.active]="currentDifficulty === 'facile'"
          (click)="changeDifficulty('facile')"
          (mouseenter)="previewDifficulty('facile')">
          <span class="difficulty-icon">ğŸŸ¢</span>
          <span class="difficulty-name">Facile</span>
          <span class="difficulty-desc">Mots courants</span>
        </button>
        
        <button 
          class="difficulty-btn moyen"
          [class.active]="currentDifficulty === 'moyen'"
          (click)="changeDifficulty('moyen')"
          (mouseenter)="previewDifficulty('moyen')">
          <span class="difficulty-icon">ğŸ“š</span>
          <span class="difficulty-name">Moyen</span>
          <span class="difficulty-desc">Mots variÃ©s</span>
        </button>
        
        <button 
          class="difficulty-btn difficile"
          [class.active]="currentDifficulty === 'difficile'"
          (click)="changeDifficulty('difficile')"
          (mouseenter)="previewDifficulty('difficile')">
          <span class="difficulty-icon">ğŸ”¥</span>
          <span class="difficulty-name">Difficile</span>
          <span class="difficulty-desc">Mots rares (API)</span>
        </button>

        <button 
          class="difficulty-btn cauchemar"
          [class.active]="currentDifficulty === 'cauchemar'"
          (click)="changeDifficulty('cauchemar')"
          (mouseenter)="previewDifficulty('cauchemar')">
          <span class="difficulty-icon">ğŸ’€</span>
          <span class="difficulty-name">Cauchemar</span>
          <span class="difficulty-desc">Mots ultra-complexes</span>
        </button>
      </div>

      <!-- âœ… Boutons de prÃ©visualisation -->
      <div class="preview-buttons">
        <button class="preview-btn" (click)="previewDifficulty('facile')">ğŸ‘ï¸ Facile</button>
        <button class="preview-btn" (click)="previewDifficulty('moyen')">ğŸ‘ï¸ Moyen</button>
        <button class="preview-btn" (click)="previewDifficulty('difficile')">ğŸ‘ï¸ Difficile</button>
        <button class="preview-btn" (click)="previewDifficulty('cauchemar')">ğŸ‘ï¸ Cauchemar</button>
      </div>
    </div>
  </div>

  <!-- Zone de jeu principale avec lÃ©gende sur le cÃ´tÃ© -->
  <div class="main-game-area" *ngIf="!isLoading">
    <!-- Grille de jeu -->
    <div class="game-grid" [class.loading]="isLoading">
      <div class="grid-row" *ngFor="let row of grid; let i = index">
        <div 
          class="grid-cell" 
          [ngClass]="{
            'correct': cell.state === 'correct',
            'present': cell.state === 'present', 
            'absent': cell.state === 'absent',
            'incorrect': cell.state === 'incorrect',
            'hint': cell.state === 'hint',
            'current': i === currentRow && j === currentCol,
            'empty': cell.state === 'empty'
          }"
          *ngFor="let cell of row; let j = index"
        >
          {{ cell.letter }}
        </div>
      </div>
    </div>

    <!-- LÃ©gende des couleurs (sur le cÃ´tÃ© en grand Ã©cran) -->
    <div class="color-legend">
      <h3>ğŸ¨ LÃ©gende</h3>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-cell correct-motus">A</div>
          <div class="legend-text">
            <strong>CarrÃ© rouge :</strong> Correcte et bien placÃ©e
          </div>
        </div>
        <div class="legend-item">
          <div class="legend-cell present-motus">B</div>
          <div class="legend-text">
            <strong>Cercle jaune :</strong> PrÃ©sente mais mal placÃ©e
          </div>
        </div>
        <div class="legend-item">
          <div class="legend-cell absent-motus">C</div>
          <div class="legend-text">
            <strong>Fond bleu :</strong> Absente du mot
          </div>
        </div>
        <div class="legend-item">
          <div class="legend-cell hint">{{ hint || 'M' }}</div>
          <div class="legend-text">
            <strong>Indice :</strong> PremiÃ¨re lettre rÃ©vÃ©lÃ©e
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Message de chargement -->
  <div *ngIf="isLoading" class="loading-message">
    <p>Chargement d'un nouveau mot...</p>
  </div>

  <!-- Clavier virtuel -->
  <app-keyboard 
    (keyPressed)="handleKeyPress($event)"
    [disabled]="isLoading || gameOver"
    [keyStates]="keyStates"
  ></app-keyboard>

  <!-- Message de fin de partie -->
  <div *ngIf="gameOver" class="game-over">
    <h2>Partie terminÃ©e !</h2>
    <div class="game-result">
      <!-- âœ… Messages conditionnels corrigÃ©s -->
      <p *ngIf="wordFound">ğŸ‰ FÃ©licitations ! Vous avez trouvÃ© le mot !</p>
      <p *ngIf="!wordFound" class="failure-message">ğŸ˜” Dommage ! Vous n'avez pas trouvÃ© le mot...</p>
      
      <div *ngIf="targetWord && targetWord !== 'X'.repeat(wordLength)" class="target-word">
        <div class="word-label">Le mot Ã  trouver Ã©tait :</div>
        <div class="word-value">{{ targetWord }}</div>
      </div>
      
      <!-- âœ… RÃ©sumÃ© des performances -->
      <div class="performance-summary" *ngIf="sessionStats.wordsFound > 0">
        <h3>ğŸ“Š RÃ©sumÃ© de votre session</h3>
        <div class="summary-stats">
          <div class="summary-item">
            <span class="summary-label">Score total :</span>
            <span class="summary-value">{{ sessionStats.totalScore }} points</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Mots trouvÃ©s :</span>
            <span class="summary-value">{{ sessionStats.wordsFound }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Meilleure sÃ©rie :</span>
            <span class="summary-value">{{ sessionStats.bestStreak }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Mots parfaits :</span>
            <span class="summary-value">{{ sessionStats.perfectWords }} â­</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="game-over-actions">
      <button class="restart-button" (click)="restartGame()">Mot suivant</button>
      <button class="end-session-button" (click)="endGameSession()" *ngIf="sessionStats.wordsFound > 0">
        ğŸ Terminer la session
      </button>
    </div>
  </div>

  <!-- Statistiques (optionnel) -->
  <div class="game-stats" *ngIf="!isLoading && !gameOver">
    <div class="stat-item">
      <span class="stat-label">Longueur du mot :</span>
      <span class="stat-value">{{ wordLength }} lettres</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Ligne actuelle :</span>
      <span class="stat-value">{{ currentRow + 1 }}/6</span>
    </div>
    <div class="stat-item" *ngIf="sessionStats.bestStreak > 0">
      <span class="stat-label">Meilleure sÃ©rie :</span>
      <span class="stat-value">ğŸ”¥ {{ sessionStats.bestStreak }}</span>
    </div>
  </div>
</div>

<!-- âœ… Modal gÃ©nÃ©rique -->
<app-modal></app-modal>

<!-- âœ… SystÃ¨me de toasts (placÃ© Ã  la fin) -->
<app-toast></app-toast>

<!-- AJOUTER Ã  la toute fin du fichier, juste avant </div> final : -->
<app-leaderboard-modal
  [isVisible]="showLeaderboardModal"
  (closed)="closeLeaderboardModal()">
</app-leaderboard-modal>